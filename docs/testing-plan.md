## 学生助教管理平台 - 测试方案草案（第七阶段）

> 目标：在不额外开发大量测试代码的前提下，完成一套可执行、可展示的测试计划，覆盖后端、前端、集成流程和用户验收。

---

## 1. 测试范围与目标

- **范围**
  - 后端：数据模型、核心 API、权限控制、关键边界场景。
  - 前端：主要业务页面的交互行为、表单校验、错误提示、简单兼容性。
  - 集成：端到端业务流程（招聘、工时与薪酬、聊天与通知）。
  - 用户验收：从真实用户视角验证可用性和体验。
- **目标**
  - 确认核心业务链路在正常与常见异常输入下均可稳定运行。
  - 验证权限和安全机制的基础有效性。
  - 为后续部署提供“可上线”的信心依据。

---

## 2. 环境与账号准备

- **环境**
  - 后端：本地 Django + MySQL 开发环境。
  - 前端：本地 Vite + Vue 开发环境（或已构建版本）。
  - 数据库中预置必要的测试数据（岗位、用户、申请、工时、薪酬）。
- **测试账号**
  - 学生账号：`student1` / `student2` 等。
  - 教师账号：`faculty1` / `faculty2` 等。
  - 管理员账号：`admin`（具备 Django Admin 权限）。
  - 所有账号密码统一为可记忆的测试密码，便于多次复用。

---

## 3. 后端测试方案（7.1）

### 3.1 模型测试（模型单元测试思路）

- **关注点**
  - 字段必填 / 唯一约束是否生效。
  - 状态枚举是否限制在预期值范围内。
  - 外键关联删除策略是否符合设计（如是否允许删除仍在使用的记录）。
- **涉及模型**
  - 用户与权限：`User`、`Role`、`Permission`、`UserRole`、`RolePermission`。
  - 业务模型：`Position`、`Application`、`Timesheet`、`Salary`、`Notification`、`Conversation`、`Message`。
- **建议用例（示意）**
  - 创建一个岗位，重复创建同名岗位时是否允许（根据需求判断）。
  - 同一学生对同一岗位重复申请是否被唯一约束拦截。
  - 删除岗位时，对应申请、工时的行为是否符合预期（禁止删除或级联处理）。

> 说明：目前以“测试思路”为主，可在后续需要时转化为 Django `TestCase` 单元测试。

### 3.2 API 接口测试

- **关注点**
  - HTTP 状态码是否准确（200/201/400/401/403/404 等）。
  - 返回结构与字段是否与前端约定一致。
  - 分页、筛选、排序等参数是否生效。
- **优先接口**
  - 认证：`/api/auth/login/`、`/api/auth/profile/`。
  - 学生端：岗位列表/详情、投递申请、我的申请。
  - 教师端：岗位管理、申请审核、工时审核。
  - 助教端：工时列表/提交/编辑、薪酬列表/详情。
  - 管理端：`/api/admin/reports/monthly/`、`/api/admin/reports/trends/`。
- **测试方法**
  - 工具：Postman / Thunder Client / curl。
  - 为不同角色准备单独的环境或请求集合（包含 token）。
  - 每个接口至少包含：
    - 正常输入用例：期望成功返回与字段断言。
    - 异常输入用例：缺字段、非法 ID、参数越界，期望得到清晰错误信息。

### 3.3 权限控制测试

- **目标**
  - 确认不同角色只能访问与自身角色匹配的 API。
- **建议建立“角色-接口矩阵”**
  - 行：接口列表，例如：
    - 学生端：`GET /api/student/positions/`、`POST /api/student/applications/submit/` 等。
    - 教师端：`POST /api/faculty/positions/`、`POST /api/faculty/applications/{id}/review/` 等。
    - 助教端：`GET /api/ta/timesheets/`、`POST /api/ta/timesheets/` 等。
    - 管理端：`GET /api/admin/reports/monthly/`、`GET /api/admin/reports/trends/` 等。
  - 列：角色（未登录、学生、教师、助教、管理员）。
  - 表格中标注：允许（✅）/ 禁止（❌），并在实际测试时填入实际返回状态码。
- **关键场景**
  - 未登录访问任意受保护接口，应该得到 401/403。
  - 学生不能访问教师/管理员专属接口。
  - 教师不能操作与自己无关的岗位、申请和工时。
  - 管理端统计/report 接口只能由管理员/具备权限的 staff 访问。

### 3.4 边界情况与异常场景

- **无数据场景**
  - 数据库中无岗位/申请/工时时，看板与报表接口返回 0 或空列表，而不是 500 错误。
- **数据极值场景**
  - 同一岗位在接近最大录用人数时（如最后 1 个名额），多次并发尝试“通过申请”时的行为（简化为顺序操作进行逻辑验证）。
- **时间与状态边界**
  - 跨月、跨年数据（12 月到次年 1 月）在月度报表与趋势接口中的统计是否正确。
  - 各状态迁移是否允许（例如：已拒绝的申请是否仍可变更为已通过等）。

---

## 4. 前端测试方案（7.2）

### 4.1 关键页面与组件检查

- **页面范围**
  - 登录 / 注册。
  - 学生端：学生看板、岗位列表与详情、我的申请、工时与薪酬相关页面。
  - 教师端：教师看板、岗位管理、申请审核、工时审核。
  - 助教端：助教看板、工时管理、薪酬记录。
  - 通知中心组件、聊天页面。
- **检查要点**
  - 必填表单项留空时是否有明显提示，并阻止提交。
  - 不合法输入（如错误邮箱格式、过长文本等）是否有前端校验提示。
  - 后端返回错误（如 4xx/5xx）时，是否在前端以统一方式展示错误信息。
  - 长操作（如列表加载、提交表单）时是否有加载状态或禁用按钮，避免重复提交。

### 4.2 手工端到端走查（E2E 思路）

- **学生主流程**
  1. 注册并登录为学生。
  2. 浏览岗位列表与详情。
  3. 对某一岗位发起申请（在线填写或上传简历）。
  4. 在“我的申请”中查看申请状态变化。
  5. 收到对应申请变更通知。
  6. 提交工时，查看工时列表。
  7. 查看薪酬记录与详情。

- **教师主流程**
  1. 登录教师账号。
  2. 创建/编辑/关闭岗位。
  3. 查看岗位申请列表，并对申请进行通过/拒绝操作。
  4. 查看待审核工时，并进行审核。
  5. 在审核页面中通过聊天入口联系学生/助教。

- **管理员主流程**
  1. 登录 Django Admin。
  2. 查看管理端首页数据看板。
  3. 使用报表导出功能导出本月 CSV。
  4. 打开趋势页面，切换不同指标和时间维度，确认图表与表格展示正常。

> 建议为每条流程准备一行记录表：步骤 / 期望结果 / 实际结果 / 是否通过 / 备注。

### 4.3 浏览器兼容性

- **建议覆盖浏览器**
  - Chrome（主测试浏览器）。
  - Edge。
  - Firefox。
- **检查内容**
  - 布局是否有明显错位（特别是表格、卡片布局、侧边栏）。
  - 表单控件、弹窗组件是否正常出现和关闭。
  - 聊天窗口与通知下拉在不同浏览器的交互行为是否一致。

---

## 5. 集成测试方案（7.3）

> 集成测试以“业务场景”为单位，重点验证跨模块的整体链路是否打通。

### 5.1 场景一：完整招聘流程

- **流程**
  1. 教师发布一个新岗位。
  2. 学生在前端岗位列表中看到并查看详情。
  3. 学生对该岗位投递申请。
  4. 教师在申请审核页面查看并处理该申请（通过/拒绝）。
  5. 学生在“我的申请”中看到状态更新，同时在通知中心收到对应通知。
- **验证点**
  - 各角色间数据是否正确关联（岗位-申请-用户）。
  - 通知内容与状态是否一致。

### 5.2 场景二：工时与薪酬闭环

- **流程**
  1. 助教在前端提交某岗位的工时表。
  2. 教师在工时审核页面查看并通过该工时。
  3. 管理员在后台查看对应的薪酬记录/统计（或生成薪酬相关数据）。
  4. 助教在“薪酬记录”页面查看到已生成的薪酬信息。
- **验证点**
  - 工时状态变化是否正确（提交 → 待审核 → 已通过）。
  - 薪酬统计是否将通过的工时纳入计算。

### 5.3 场景三：聊天与通知联动

- **流程**
  1. 学生在岗位详情页点击“联系教师”发起会话。
  2. 教师在聊天页面或审核页面打开与该学生的会话并回复。
  3. 学生在聊天页面看到教师的回复。
  4. 可选：观察通知中心是否有相关新消息提示（视实现情况而定）。
- **验证点**
  - 会话是否按双方身份正确创建。
  - 消息发送与接收是否实时或在页面刷新后可见。

---

## 6. 用户验收测试方案（7.4）

### 6.1 参与角色与方式

- 角色分工：
  - 1 名“学生”角色体验者。
  - 1 名“教师”角色体验者。
  - 1 名“管理员”角色体验者（可由开发者兼任）。
- 方式：
  - 演示背景需求与角色定位，给出账号密码。
  - 不做过多操作指导，让体验者按自己的理解完成指定任务。

### 6.2 UAT 检查清单（示意）

- 每个角色一页检查清单，包含：
  - **任务名称**：例如“学生：完成一次岗位申请并查看状态”。
  - **操作步骤（简要）**。
  - **期望结果**：界面内容、状态变化等。
  - **实际结果**：由体验者或观察者填写。
  - **是否通过**：是 / 否。
  - **问题与建议**：记录文案不清晰、操作不直观等。

### 6.3 结果评估

- 将 UAT 发现的问题按优先级分类：
  - 必须修复（影响核心流程、数据错误、严重体验问题）。
  - 可选优化（文案、布局、额外交互优化）。
- 对“必须修复”的问题在后续迭代中进行针对性修改，并在 TODO 或 Issues 中登记。

---

## 7. 输出与归档

- **测试记录**
  - 建议在 `docs/` 目录下增加简单的执行记录表，例如 `testing-log.md`（可选）。
  - 记录每次测试的时间、参与人、主要结果与发现的问题列表。
- **展示与答辩要点**
  - 强调本项目不仅实现了完整业务闭环，还设计了覆盖后端、前端、集成和用户验收的测试方案。
  - 可以展示：
    - Postman/Thunder Client 的请求集合截图。
    - 前端关键流程操作录屏或截图。
    - UAT 检查清单和部分反馈结论。

